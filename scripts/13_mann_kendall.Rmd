---
title: "14_mann_kendall"
author: "Léa Bouchet"
date: "2024-06-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

# Objectif : Dynamique de population des poissons d'eau douce de Bretagne

Script : 14_Mann_Kendall

Ce script a pour objectif de réaliser des tests de Mann-Kendall sur les tendances des indicateurs régionaux. Il a également l'objectif de comparer les données issues des test de M-K avec ceux des modèles linéaires généralisés (GLM) afin d'observer les divergences entre ces deux modèles. 


# Installation 

## Chargement des packages, fonctions et des données 

```{r Chargement des packages}
## Chargement des packages ----
library(ggthemes)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(trend)
library(ggh4x)

```

```{r Chargement des données}
## Chargement des données 
load(file = "../processed_data/calcul_indicateurs_regionaux.rda")
load(file = "../processed_data/analyse_indicateurs_regionaux_pour_mk_glm.rda")
```

```{r Chargement des fonctions}

source(file = "../R/mk_st_by_group.R") # Fonction développée par Pascal Irz
source(file = "../R/mann_kendall_sen.R") # Fonction développée par Pascal Irz
source(file = "../R/mk_st_multi_periodes.R") #Fonction qui utilise des "" donc à corriger mais fait par Léa Bouchet
```


# Test de Mann-Kendall

## Introduction

Le test de tendance de Mann-Kendall est utilisé pour déterminer si une tendance existe ou non dans les données de séries chronologiques. Il s'agit d'un test non paramétrique, ce qui signifie qu'il n'y a pas d'hypothèse sous-jacente concernant la normalité des données.

Il s'agit d'un test d'hypothèses et les deux hypothèses sont les suivantes :
  1. Ho (Accepté) : Il n'y a pas de tendance dans les données (valeur p>0,05).
  2. Ha (Rejeté) : Une tendance est présente dans les données



## Application 

On souhaite le faire pour plusieurs périodes (création de la fonction *mk_st_multi_periodes*). Nous sélectionnons les périodes à étudier (qui sera une variable de la fonction) : 



```{r Mise en place des périodes}
periodes <- list(c(1990,2023),
                 c(2005, 2023), 
                 c(2008, 2023),
                 c(2011, 2023),
                 c(2013, 2023))
```



Nous exécutons la fonction *mk_st_multi_periodes* qui permet de calculer les différents test de Mann Kendall et pentes de Sen Theil pour les différentes périodes indiquées ci-avant. 

```{r}
mk_st_by_group_resultats_reg_LRR <- mk_st_multi_periodes(df = reg_indicateur_tri_final_tendances_LRR,
                                                     periods = periodes,
                                                     valeur = "valeur",
                                                     annee = "annee",
                                                     esp_code_alternatif = "esp_code_alternatif",
                                                     indicateur = "indicateur",
                                                     stade = "stade")
```


Sauvegarde : 

```{r}
save(mk_st_by_group_resultats,
     file = "../processed_data/mann_kendall_tendances.rda")
```

